(()=>{"use strict";var e={100:e=>{var t,s="object"==typeof Reflect?Reflect:null,a=s&&"function"==typeof s.apply?s.apply:function(e,t,s){return Function.prototype.apply.call(e,t,s)};t=s&&"function"==typeof s.ownKeys?s.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)};var r=Number.isNaN||function(e){return e!=e};function n(){n.init.call(this)}e.exports=n,e.exports.once=function(e,t){return new Promise((function(s,a){function r(s){e.removeListener(t,n),a(s)}function n(){"function"==typeof e.removeListener&&e.removeListener("error",r),s([].slice.call(arguments))}v(e,t,n,{once:!0}),"error"!==t&&function(e,t,s){"function"==typeof e.on&&v(e,"error",t,{once:!0})}(e,r)}))},n.EventEmitter=n,n.prototype._events=void 0,n.prototype._eventsCount=0,n.prototype._maxListeners=void 0;var i=10;function o(e){if("function"!=typeof e)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof e)}function c(e){return void 0===e._maxListeners?n.defaultMaxListeners:e._maxListeners}function d(e,t,s,a){var r,n,i,d;if(o(s),void 0===(n=e._events)?(n=e._events=Object.create(null),e._eventsCount=0):(void 0!==n.newListener&&(e.emit("newListener",t,s.listener?s.listener:s),n=e._events),i=n[t]),void 0===i)i=n[t]=s,++e._eventsCount;else if("function"==typeof i?i=n[t]=a?[s,i]:[i,s]:a?i.unshift(s):i.push(s),(r=c(e))>0&&i.length>r&&!i.warned){i.warned=!0;var l=new Error("Possible EventEmitter memory leak detected. "+i.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");l.name="MaxListenersExceededWarning",l.emitter=e,l.type=t,l.count=i.length,d=l,console&&console.warn&&console.warn(d)}return e}function l(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function h(e,t,s){var a={fired:!1,wrapFn:void 0,target:e,type:t,listener:s},r=l.bind(a);return r.listener=s,a.wrapFn=r,r}function g(e,t,s){var a=e._events;if(void 0===a)return[];var r=a[t];return void 0===r?[]:"function"==typeof r?s?[r.listener||r]:[r]:s?function(e){for(var t=new Array(e.length),s=0;s<t.length;++s)t[s]=e[s].listener||e[s];return t}(r):u(r,r.length)}function p(e){var t=this._events;if(void 0!==t){var s=t[e];if("function"==typeof s)return 1;if(void 0!==s)return s.length}return 0}function u(e,t){for(var s=new Array(t),a=0;a<t;++a)s[a]=e[a];return s}function v(e,t,s,a){if("function"==typeof e.on)a.once?e.once(t,s):e.on(t,s);else{if("function"!=typeof e.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof e);e.addEventListener(t,(function r(n){a.once&&e.removeEventListener(t,r),s(n)}))}}Object.defineProperty(n,"defaultMaxListeners",{enumerable:!0,get:function(){return i},set:function(e){if("number"!=typeof e||e<0||r(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");i=e}}),n.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},n.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||r(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this},n.prototype.getMaxListeners=function(){return c(this)},n.prototype.emit=function(e){for(var t=[],s=1;s<arguments.length;s++)t.push(arguments[s]);var r="error"===e,n=this._events;if(void 0!==n)r=r&&void 0===n.error;else if(!r)return!1;if(r){var i;if(t.length>0&&(i=t[0]),i instanceof Error)throw i;var o=new Error("Unhandled error."+(i?" ("+i.message+")":""));throw o.context=i,o}var c=n[e];if(void 0===c)return!1;if("function"==typeof c)a(c,this,t);else{var d=c.length,l=u(c,d);for(s=0;s<d;++s)a(l[s],this,t)}return!0},n.prototype.addListener=function(e,t){return d(this,e,t,!1)},n.prototype.on=n.prototype.addListener,n.prototype.prependListener=function(e,t){return d(this,e,t,!0)},n.prototype.once=function(e,t){return o(t),this.on(e,h(this,e,t)),this},n.prototype.prependOnceListener=function(e,t){return o(t),this.prependListener(e,h(this,e,t)),this},n.prototype.removeListener=function(e,t){var s,a,r,n,i;if(o(t),void 0===(a=this._events))return this;if(void 0===(s=a[e]))return this;if(s===t||s.listener===t)0==--this._eventsCount?this._events=Object.create(null):(delete a[e],a.removeListener&&this.emit("removeListener",e,s.listener||t));else if("function"!=typeof s){for(r=-1,n=s.length-1;n>=0;n--)if(s[n]===t||s[n].listener===t){i=s[n].listener,r=n;break}if(r<0)return this;0===r?s.shift():function(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}(s,r),1===s.length&&(a[e]=s[0]),void 0!==a.removeListener&&this.emit("removeListener",e,i||t)}return this},n.prototype.off=n.prototype.removeListener,n.prototype.removeAllListeners=function(e){var t,s,a;if(void 0===(s=this._events))return this;if(void 0===s.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==s[e]&&(0==--this._eventsCount?this._events=Object.create(null):delete s[e]),this;if(0===arguments.length){var r,n=Object.keys(s);for(a=0;a<n.length;++a)"removeListener"!==(r=n[a])&&this.removeAllListeners(r);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(t=s[e]))this.removeListener(e,t);else if(void 0!==t)for(a=t.length-1;a>=0;a--)this.removeListener(e,t[a]);return this},n.prototype.listeners=function(e){return g(this,e,!0)},n.prototype.rawListeners=function(e){return g(this,e,!1)},n.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):p.call(e,t)},n.prototype.listenerCount=p,n.prototype.eventNames=function(){return this._eventsCount>0?t(this._events):[]}},888:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Adblock=void 0;const s="adblocker.enabled",a="adblocker_enabled";t.Adblock=class{constructor(e){this.variableStore=e,void 0!==chrome.settingsPrivate&&(chrome.settingsPrivate.getPref(s,(e=>{this.variableStore.setInt(a,e.value?1:0)})),chrome.settingsPrivate.onPrefsChanged.addListener((e=>{e.forEach((e=>{e.key===s&&this.variableStore.setInt(a,e.value?1:0)}))})))}static registerVariables(e){e.registerIntVariable(a,0)}}},235:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.reloadStartpagesInAllWindowsWhenInBackground=void 0;class s{constructor(e){this.onStartpageInWindowReloaded=e,this.windowsToWaitFor=new Set,this.tabActivatedListener=e=>this.onTabActivated(e),this.tabUpdatedListener=(e,t,s)=>this.onTabUpdated(e,t,s),this.windowRemovedListener=e=>this.onWindowRemoved(e),(async()=>{var e;const t=await new Promise((e=>chrome.windows.getAll((t=>e(t.filter((e=>"normal"===e.type||"popup"===e.type))))))),s=await Promise.all(t.map((e=>new Promise((t=>{chrome.tabs.query({active:!0,windowId:e.id},(s=>t({windowId:e.id,activeTab:s[0]})))})))));for(const t of s)(null===(e=t.activeTab.url)||void 0===e?void 0:e.startsWith("chrome://startpage"))?this.windowsToWaitFor.add(t.windowId):opr.speeddialPrivate.reloadInWindow(t.windowId,(()=>{}));0!==this.windowsToWaitFor.size&&(chrome.tabs.onActivated.addListener(this.tabActivatedListener),chrome.tabs.onUpdated.addListener(this.tabUpdatedListener),chrome.windows.onRemoved.addListener(this.windowRemovedListener))})()}onTabActivated(e){this.windowsToWaitFor.has(e.windowId)&&chrome.tabs.get(e.tabId,(e=>{this.reloadStartpageIfInBackground(e.windowId,e.url)}))}onTabUpdated(e,t,s){this.windowsToWaitFor.has(s.windowId)&&s.active&&t.url&&this.reloadStartpageIfInBackground(s.windowId,s.url)}onWindowRemoved(e){this.windowsToWaitFor.delete(e),this.onWindowHandled(e)}reloadStartpageIfInBackground(e,t){t.startsWith("chrome://startpage")||(opr.speeddialPrivate.reloadInWindow(e,(()=>{this.onStartpageInWindowReloaded(e)})),this.onWindowHandled(e))}onWindowHandled(e){this.windowsToWaitFor.delete(e),0===this.windowsToWaitFor.size&&(chrome.tabs.onActivated.removeListener(this.tabActivatedListener),chrome.tabs.onUpdated.removeListener(this.tabUpdatedListener),chrome.windows.onRemoved.removeListener(this.windowRemovedListener))}}t.reloadStartpagesInAllWindowsWhenInBackground=function(e){new s(e)}},932:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.BrowserLaunchedWithTagAssigned=void 0;class s{constructor(e){this.backend=e}static eventNameForTag(e){return`browser-launched-with-tag-${e}`}fireEvent(){opr.richHintsAgentPrivate.fireEvent({eventName:s.eventNameForTag(this.backend.tagName)})}async activate(){await this.backend.wasRecentlyLaunchedWithTag()&&this.fireEvent()}async deactivate(){}}t.BrowserLaunchedWithTagAssigned=s},793:(e,t)=>{var s;Object.defineProperty(t,"__esModule",{value:!0}),t.CashbackBadgeShownEventSource=void 0,function(e){e[e.INITIALIZING_WINDOW=0]="INITIALIZING_WINDOW",e[e.COMPUTING_IF_COMMIT_CHECK_NEEDED=1]="COMPUTING_IF_COMMIT_CHECK_NEEDED",e[e.WATING_FOR_TAB_COMMIT=2]="WATING_FOR_TAB_COMMIT",e[e.IDLE=3]="IDLE"}(s||(s={}));class a{constructor(e){this.windowCreatedClosures=[],this._state=s.INITIALIZING_WINDOW,this._state=e?s.IDLE:s.INITIALIZING_WINDOW}get hasWindowData(){return this._state!==s.INITIALIZING_WINDOW}get computingIfCommitCheckNeeded(){return this._state===s.COMPUTING_IF_COMMIT_CHECK_NEEDED}get waitingForTabCommit(){return this._state===s.WATING_FOR_TAB_COMMIT}onWindowCreated(){var e;this._state=s.IDLE;for(const t of null!==(e=this.windowCreatedClosures)&&void 0!==e?e:[])t();this.windowCreatedClosures=[]}onComputingIfCommitCheckNeeded(){this._state=s.COMPUTING_IF_COMMIT_CHECK_NEEDED}waitForTabCommit(e){this._state=s.WATING_FOR_TAB_COMMIT;let t=this.stateClosure;this.stateClosure=e,t&&t()}onIdle(){this._state=s.IDLE}commitTab(){this._state=s.IDLE,this.stateClosure&&this.stateClosure(),this.stateClosure=void 0}addWindowReadyClosure(e){this.windowCreatedClosures.push(e)}setStateClosure(e){this.stateClosure=e}}class r{constructor(e){this.variableStore=e,this.cashbackStatesForWindows=new Map,this.cashbackBadgeStateChangedListener=(e,t)=>this.onCashbackStateChanged(e,t),this.windowCreatedListener=e=>this.onWindowCreated(e),this.windowRemovedListener=e=>this.onWindowRemoved(e),this.tabActivatedListener=e=>this.onTabActivated(e)}static isAvailable(){return void 0!==opr.cashbackPrivate}static registerVariables(e){for(const t in this.VARIABLES)e.registerStringVariable(t,this.VARIABLES[t].default)}getWindowState(e){let t=this.cashbackStatesForWindows.get(e);return t||(t={supported:!1,state:opr.cashbackPrivate.BadgeState.DISABLED,stateManager:new a(!1)},this.cashbackStatesForWindows.set(e,t),t)}getTabInfo(e){return new Promise((t=>{chrome.tabs.query(e,(e=>{t(e[0])}))}))}getCashbackBadgeState(e){return new Promise((t=>opr.cashbackPrivate.getCashbackBadgeState(e,t)))}async onCashbackStateChanged(e,t){const s=this.getWindowState(e);if(!s.stateManager.hasWindowData)return void s.stateManager.addWindowReadyClosure((()=>this.onCashbackStateChanged(e,t)));if(!s.supported)return;s.stateManager.onComputingIfCommitCheckNeeded();const a=await this.getTabInfo({active:!0,windowId:e});let r=()=>s.stateManager.onIdle();try{if(void 0===a)return void s.stateManager.onIdle();if(s.lastKnownActiveTabId!==a.id)return void(r=()=>s.stateManager.waitForTabCommit((()=>this.onCashbackStateChanged(e,t))));s.state===opr.cashbackPrivate.BadgeState.DISABLED&&t!==opr.cashbackPrivate.BadgeState.DISABLED&&await this.fireEvent(a.url),s.state=t}finally{r()}}onWindowCreated(e){const t=this.getWindowState(e.id);t.supported="normal"===e.type&&!e.incognito,t.stateManager.onWindowCreated()}onWindowRemoved(e){this.cashbackStatesForWindows.delete(e)}async onTabActivated(e){const t=this.getWindowState(e.windowId);if(t.stateManager.hasWindowData){if(t.supported)if(t.stateManager.computingIfCommitCheckNeeded)t.stateManager.setStateClosure((()=>this.onTabActivated(e)));else try{if(t.stateManager.waitingForTabCommit)return;const s=await this.getCashbackBadgeState(e.windowId);if(t.state=s,s===opr.cashbackPrivate.BadgeState.DISABLED)return;const a=await new Promise((t=>chrome.tabs.get(e.tabId,t)));await this.fireEvent(a.url)}finally{t.lastKnownActiveTabId=e.tabId,t.stateManager.commitTab()}}else t.stateManager.addWindowReadyClosure((()=>this.onTabActivated(e)))}async fireEvent(e){await this.variableStore.setString("page_with_cashback",e),await new Promise((e=>opr.richHintsAgentPrivate.fireEvent({eventName:r.NAME},e)))}async activate(){const e=await new Promise((e=>chrome.windows.getAll(e)));chrome.tabs.onActivated.addListener(this.tabActivatedListener),this.cashbackStatesForWindows=new Map(await Promise.all(e.map((e=>new Promise((async t=>{const s="normal"===e.type&&!e.incognito;t([e.id,{supported:s,state:s?await new Promise((t=>{opr.cashbackPrivate.getCashbackBadgeState(e.id,t)})):opr.cashbackPrivate.BadgeState.DISABLED,stateManager:new a(!0)}])})))))),chrome.windows.onCreated.addListener(this.windowCreatedListener),chrome.windows.onRemoved.addListener(this.windowRemovedListener),opr.cashbackPrivate.onCashbackBadgeStateChanged.addListener(this.cashbackBadgeStateChangedListener)}async deactivate(){chrome.tabs.onActivated.removeListener(this.tabActivatedListener),opr.cashbackPrivate.onCashbackBadgeStateChanged.removeListener(this.cashbackBadgeStateChangedListener),chrome.windows.onRemoved.removeListener(this.windowRemovedListener),chrome.windows.onCreated.removeListener(this.windowCreatedListener)}}t.CashbackBadgeShownEventSource=r,r.NAME="cashback-badge-shown",r.VARIABLES={page_with_cashback:{default:"none",description:"Page that generated the cashback-badge-shown event"}}},254:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CheckoutPageEventSource=void 0;class s{constructor(e){this.variableStore=e,this.tabsWithForms=new Map,this.autofillFormDetectedCallback=(e,t)=>this.onAutofillFormDetected(e,t),this.tabsUpdatedCallback=(e,t,s)=>this.onTabsUpdated(e,t,s),this.tabsActivatedCallback=e=>this.onTabActivated(e)}static isAvailable(){return void 0!==opr.richHintsAgentPrivate.onAutofillFormDetected}static registerVariables(e){for(const t in this.VARIABLES)e.registerStringVariable(t,this.VARIABLES[t].default)}async activate(){opr.richHintsAgentPrivate.onAutofillFormDetected.addListener(this.autofillFormDetectedCallback),chrome.tabs.onActivated.addListener(this.tabsActivatedCallback),chrome.tabs.onUpdated.addListener(this.tabsUpdatedCallback)}async deactivate(){opr.richHintsAgentPrivate.onAutofillFormDetected.removeListener(this.autofillFormDetectedCallback),chrome.tabs.onActivated.removeListener(this.tabsActivatedCallback),chrome.tabs.onUpdated.removeListener(this.tabsUpdatedCallback)}async fireEvent(e,t){await this.variableStore.setString("page_with_checkout_form",t),opr.richHintsAgentPrivate.fireEvent({eventName:s.NAME,windowId:e})}onAutofillFormDetected(e,t){this.isCheckoutFormHeuristics(t)&&chrome.tabs.get(e,(t=>{this.tabsWithForms.set(e,t.url),t.active&&this.fireEvent(t.windowId,t.url)}))}onTabsUpdated(e,t,s){t.url&&this.tabsWithForms.delete(e)}onTabActivated(e){const t=this.tabsWithForms.get(e.tabId);t&&this.fireEvent(e.windowId,t)}isCheckoutFormHeuristics(e){return e.fields.find((e=>e.type===opr.richHintsAgentPrivate.AutofillFieldType.CREDIT_CARD_NUMBER))&&e.fields.map((e=>e.group===opr.richHintsAgentPrivate.AutofillFieldGroup.CREDIT_CARD?1:0)).reduce(((e,t)=>e+t))>=2}}t.CheckoutPageEventSource=s,s.NAME="checkout-page",s.VARIABLES={page_with_checkout_form:{default:"none",description:"Page that generated the checkout-page event"}}},498:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ClockEventSource=t.AgentClock=void 0;const a=s(100);class r{constructor(e){this.variableStore=e,this.sessionStartTime=-1,this.eventEmitter=new a.EventEmitter}static registerVariables(e){for(const t in this.VARIABLES)e.registerStringVariable(t,this.VARIABLES[t].default)}onMinutePassed(e){this.eventEmitter.on("minute-passed",e)}setOnBeforeMinutePassedBarrier(e){this.onBeforeMinutePassedBarrier=e}removeCallback(e){this.eventEmitter.removeListener("minute-passed",e)}async init(e){const t=await new Promise((e=>chrome.storage.local.get("session_data",(t=>{var s;return e(null!==(s=t.session_data)&&void 0!==s?s:{})}))));this.sessionStartTime=await(async()=>("extension_update"===e&&"number"==typeof t.sessionStartTime||(t.sessionStartTime=Date.now(),await new Promise((e=>chrome.storage.local.set({session_data:t},e)))),t.sessionStartTime))(),window.setInterval((()=>this.minutePassedHandler()),6e4),this.minutePassedHandler()}async minutePassedHandler(){const e=Math.round((Date.now()-this.sessionStartTime)/6e4);this.variableStore.setInt("minutes_since_startup",e),this.onBeforeMinutePassedBarrier&&await this.onBeforeMinutePassedBarrier(),this.eventEmitter.emit("minute-passed")}}t.AgentClock=r,r.VARIABLES={minutes_since_startup:{default:0,description:"Time since Opera launched"}};class n{constructor(e){this.clock=e,this.minutePassedCallback=()=>this.onMinutePassed()}async activate(){this.clock.onMinutePassed(this.minutePassedCallback)}async deactivate(){this.clock.removeCallback(this.minutePassedCallback)}onMinutePassed(){opr.richHintsAgentPrivate.fireEvent({eventName:n.NAME})}}t.ClockEventSource=n,n.NAME="minute-passed"},150:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Constants=void 0,t.Constants=class{constructor(e){this.productType=e}static async getProductType(){if(opr.operaBrowserPrivate)switch(await new Promise((e=>opr.operaBrowserPrivate.getProduct(e)))){case"Opera Crypto":return"crypto";case"Opera GX":return"gx";case"Opera":return"opera";default:return}}}},696:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.DisplayTargetedSDSectionFunctionMessage=t.CallTestStartpageFunctionMessage=t.ACS_CallStartpageFunctionMessage=t.ACS_UseApiMessage=t.ContentScriptMessageWithApiType=t.ACS_ErrorMessage=t.CSA_Web3InsightsEventMessage=t.CSA_StartpageAPIEventMessage=t.CSA_CallStartpageFunctionResponseMessage=t.ApiToContentScriptMessage=t.ContentScriptToApiMessage=t.ContentScriptConnectionMessage=void 0;class s{constructor(e,t){this.type=e,this.requestId=t,this.id=s.nextId++}}t.ContentScriptConnectionMessage=s,s.nextId=0;class a extends s{}t.ContentScriptToApiMessage=a;class r extends s{}t.ApiToContentScriptMessage=r;class n extends a{constructor(e,t,s){super("CSA_CallStartpageFunctionResponse",t),this.result=e,this.data=s}static fromRawMessage(e){if("CSA_CallStartpageFunctionResponse"!==e.type||"boolean"!=typeof e.result||"number"!=typeof e.requestId||"object"!=typeof e.data)throw new Error("Unparseable message");return new n(e.result,e.requestId,e.data)}}t.CSA_CallStartpageFunctionResponseMessage=n;class i extends a{constructor(e,t,s){super("CSA_StartpageAPIEvent"),this.result=e,this.name=t,this.data=s}static fromRawMessage(e){if("CSA_StartpageAPIEvent"!==e.type||"string"!=typeof e.name||"object"!=typeof e.data)throw new Error("Unparseable message");return new i(e.result,e.name,e.data)}}t.CSA_StartpageAPIEventMessage=i;class o extends a{constructor(e,t,s){super("CSA_Web3InsightsEvent"),this.result=e,this.name=t,this.data=s}static fromRawMessage(e){if("CSA_Web3InsightsEvent"!==e.type||"string"!=typeof e.name||"object"!=typeof e.data)throw new Error("Unparseable message");return new o(e.result,e.name,e.data)}}t.CSA_Web3InsightsEventMessage=o,t.ACS_ErrorMessage=class extends r{constructor(e){super("ACS_Error"),this.message=e}};class c extends r{constructor(e,t,s){super(e,s),this.functionName=t}}t.ContentScriptMessageWithApiType=c;class d extends c{constructor(e,t,s,a){super(e,t,s),this.params=a}}t.ACS_UseApiMessage=d;class l extends d{constructor(e,t,s,a){super(l.MESSAGE_TYPE,e,t,a),this.windowId=s}}t.ACS_CallStartpageFunctionMessage=l,l.MESSAGE_TYPE="ACS_CallStartpageFunction";class h extends l{constructor(e,t,s,a){super("TestStartpageFunction",e,t,{boxColour:s,text:a})}get boxColour(){return this.params.boxColour}get text(){return this.params.text}static fromParams(e,t,s){const a=s.get("colour");if("string"!=typeof a)throw new Error(`Bad colour ${a}`);const r=s.get("text");if("string"!=typeof a)throw new Error(`Bad colour ${a}`);return new h(e,t,a,r)}static fromRawMessage(e){if("object"!=typeof e.params)throw new Error("params not an object");if("string"!=typeof e.params.boxColour)throw new Error("boxColour not a string");if("string"!=typeof e.params.text)throw new Error("text not a string");return new h(e.requestId,e.windowId,e.params.boxColour,e.params.text)}}t.CallTestStartpageFunctionMessage=h;class g extends l{constructor(e,t,s,a,r,n,i,o,c,d,l){super("DisplayTargetedSDSection",e,t,{tiles:s,sectionTitle:a,folded:r,doubleWidthTiles:n,noWrap:i,tileHeight:o,closeMenuOptionNames:c,feedbackEnabled:d,campaignId:l}),this.tiles=s,this.sectionTitle=a,this.folded=r,this.doubleWidthTiles=n,this.noWrap=i,this.tileHeight=o,this.closeMenuOptionNames=c,this.feedbackEnabled=d,this.campaignId=l}static createTilesFromArray(e){let t=[];for(let s of e){if("string"!=typeof s.clickUrl)throw new Error("tiles[i].clickUrl must be a string");if("string"!=typeof s.imageUrl)throw new Error("tiles[i].imageUrl must be a string");if("string"!=typeof s.title)throw new Error("tiles[i].title must be a string");t.push({clickUrl:s.clickUrl,imageUrl:s.imageUrl,title:s.title})}return t}static fromParams(e,t,s){const a=s.get("tiles");if(!(a instanceof Array))throw new Error("tiles should be an array");const r=s.get("sectionTitle");if("string"!=typeof r)throw new Error("sectionTitle should be a string");const n=s.get("folded");if("boolean"!=typeof n)throw new Error("folded should be a boolean");const i=s.get("doubleWidthTiles");if("boolean"!=typeof i)throw new Error("doubleWidthTiles should be a boolean");const o=s.get("noWrap");if("boolean"!=typeof o)throw new Error("noWrap should be a boolean");const c=s.get("tileHeight");if("number"!=typeof c)throw new Error("tileHeight should be a number");const d=s.get("closeMenuOptionNames");if(d instanceof Array&&d.some((e=>"string"!=typeof e)))throw new Error("closeMenuOptionNames should be a string array");const l=s.get("feedbackEnabled");if("boolean"!=typeof l)throw new Error("feedbackEnabled should be a boolean");const h=s.get("campaignId");if("string"!=typeof h)throw new Error("campaignId should be a string");return new g(e,t,g.createTilesFromArray(a),r,n,i,o,c,d,l,h)}static fromRawMessage(e){if("object"!=typeof e.params)throw new Error("params not an object");if(!(e.params.tiles instanceof Array))throw new Error("params.tiles not an array");if("string"!=typeof e.params.sectionTitle)throw new Error("sectionTitle should be a string");if("boolean"!=typeof e.params.folded)throw new Error("folded should be a boolean");if("boolean"!=typeof e.params.doubleWidthTiles)throw new Error("doubleWidthTiles should be a boolean");if("boolean"!=typeof e.params.noWrap)throw new Error("noWrap should be a boolean");if("number"!=typeof e.params.tileHeight)throw new Error("tileHeight should be a number");if(e.params.closeMenuOptionNames instanceof Array&&e.params.closeMenuOptionNames.some((e=>"string"!=typeof e)))throw new Error("closeMenuOptionNames should be a string array");if("boolean"!=typeof e.params.feedbackEnabled)throw new Error("feedbackEnabled should be a boolean");if("string"!=typeof e.params.campaignId)throw new Error("campaignId should be a string");return new g(e.requestId,e.windowId,g.createTilesFromArray(e.tiles),e.params.sectionTitle,e.params.folded,e.params.doubleWidthTiles,e.params.noWrap,e.params.tileHeight,e.params.closeMenuOptionNames,e.params.feedbackEnabled,e.params.campaignId)}}t.DisplayTargetedSDSectionFunctionMessage=g},71:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ErrorReporter=void 0,t.ErrorReporter=class{constructor(){opr.richHintsAgentPrivate.reportFeedback&&(window.addEventListener("error",(e=>this.onUncaughtError(e.error))),window.addEventListener("unhandledrejection",(e=>this.onUnhandledRejection(e.reason))))}onUncaughtError(e){this.reportError("string"==typeof e?e:e.message)}onUnhandledRejection(e){this.reportError("string"==typeof e?e:e.message)}reportError(e){e&&opr.richHintsAgentPrivate.reportFeedback(opr.richHintsAgentPrivate.FeedbackType.ERROR,""+e)}}},778:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.EventRegistry=void 0;const a=s(100);t.EventRegistry=class{constructor(e,t,s){this.onSpecificationUpdated=e,this.provideEvents=t,this.eventSourceFactory=s,this.eventsSources=new Map,this.eventEmitter=new a.EventEmitter,this.onSpecificationUpdated.addListener((()=>{this.registerEvents()}))}on(e,t){this.eventEmitter.on(e,t)}removeListener(e,t){this.eventEmitter.removeListener(e,t)}registerEvents(){this.eventEmitter.emit("start-providing-events"),this.provideEvents(this.eventSourceFactory.getSupportedEvents(),(e=>{let t=Array.from(this.eventsSources.keys()),s=e.filter((e=>-1===t.indexOf(e))),a=t.filter((t=>-1===e.indexOf(t)));s.forEach((e=>{let t=this.eventSourceFactory.createEventSource(e);t?(this.eventsSources.set(e,t),t.activate(this)):console.warn("The event "+t+" is unknown and cannot be handled")})),a.forEach((e=>{this.eventsSources.get(e).deactivate(this),this.eventsSources.delete(e)}))}))}}},175:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.EventSourceFactoryImpl=void 0,t.EventSourceFactoryImpl=class{constructor(e){this.eventFactories=e}createEventSource(e){let t=this.eventFactories.get(e);return t?t():null}getSupportedEvents(){return Array.from(this.eventFactories.keys())}}},977:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.checkExtensionLaunchType=void 0,t.checkExtensionLaunchType=async function(){const e=await new Promise((e=>chrome.storage.local.get("launch_type_check",(t=>{var s;return e(null!==(s=t.launch_type_check)&&void 0!==s?s:{})})))),t=chrome.runtime.getManifest().version,s=void 0===e.last_recorded_version?"first_install":e.last_recorded_version===t?"browser_launch":"extension_update";return e.last_recorded_version=t,await new Promise((t=>chrome.storage.local.set({launch_type_check:e},t))),s}},919:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ExtensionPromotions=void 0;class s{constructor(e){[{id:s.ALITOOLS_EXTENSION_ID,variableNames:{has:s.HAS_ALITOOLS_VARIABLE_NAME,uninstalled:s.UNINSTALLED_ALITOOLS_VARIABLE_NAME}},{id:s.AMAZON_EXTENSION_ID,variableNames:{has:s.HAS_AMAZON_VARIABLE_NAME,uninstalled:s.UNINSTALLED_AMAZON_VARIABLE_NAME}}].forEach((t=>{chrome.management.get(t.id,(()=>{e.setInt(t.variableNames.has,void 0===chrome.runtime.lastError?1:0)})),chrome.management.onInstalled.addListener((s=>{t.id===s.id&&e.setInt(t.variableNames.has,1)})),chrome.management.onUninstalled.addListener((s=>{t.id===s&&(e.setInt(t.variableNames.has,0),e.setInt(t.variableNames.uninstalled,1))}))}))}static registerVariables(e){e.registerIntVariable(s.UNINSTALLED_ALITOOLS_VARIABLE_NAME,0),e.registerIntVariable(s.UNINSTALLED_AMAZON_VARIABLE_NAME,0),e.registerIntVariable(s.HAS_ALITOOLS_VARIABLE_NAME,0),e.registerIntVariable(s.HAS_AMAZON_VARIABLE_NAME,0)}}t.ExtensionPromotions=s,s.ALITOOLS_EXTENSION_ID="nkekkheibgkgeepapinkalkongndfajn",s.AMAZON_EXTENSION_ID="mmmbddcnnndpbdflpccgcknaaabgldak",s.HAS_ALITOOLS_VARIABLE_NAME="has_alitools",s.HAS_AMAZON_VARIABLE_NAME="has_amazon",s.UNINSTALLED_ALITOOLS_VARIABLE_NAME="uninstalled_alitools",s.UNINSTALLED_AMAZON_VARIABLE_NAME="uninstalled_amazon"},727:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ExternalConnectionBroker=t.defaultExternalConnectionPortFactory=t.ExternalConnectionPort=void 0;const a=s(100),r=s(278);class n{constructor(e,t,s){this.rawPort=t,this.portId=s,this.eventEmitter=new a.EventEmitter,t.onMessage.addListener((t=>{try{const s=e.parse(t);s.port=this,this.eventEmitter.emit("message",s)}catch(e){this.postMessage(new r.AC_ErrorMessage(e.message))}})),t.onDisconnect.addListener((e=>{this.eventEmitter.emit("disconnect",this)}))}onMessage(e){this.eventEmitter.on("message",e)}onDisconnect(e){this.eventEmitter.on("disconnect",e)}removeMessageListener(e){this.eventEmitter.removeListener("message",e)}removeDisconnectListener(e){this.eventEmitter.removeListener("disconnect",e)}postMessage(e){this.rawPort.postMessage(e)}}t.ExternalConnectionPort=n,t.defaultExternalConnectionPortFactory=function(e,t,s){return new n(e,t,s)},t.ExternalConnectionBroker=class{constructor(e,t){this.listenersForAPIs=new Map,this.nextPortId=0,chrome.runtime.onConnectExternal.addListener((s=>{const a=this.listenersForAPIs.get(s.name);if(!a)return s.postMessage(new r.AC_ErrorMessage(`No known API for ${s.name}`)),void s.disconnect();a(t(e,s,this.nextPortId++))}))}registerConnectionListener(e,t){if(this.listenersForAPIs.has(e))throw new Error("Listener already registered");this.listenersForAPIs.set(e,t)}}},278:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ExternalConnectionMessageParser=t.AC_ErrorMessage=t.ExternalConnectionClientToApiMessage=t.ExternalConnectionApiToClientMessage=t.ExternalConnectionMessage=void 0;class s{constructor(e){this.type=e,this.id=s.nextId++}}t.ExternalConnectionMessage=s,s.nextId=0;class a extends s{}t.ExternalConnectionApiToClientMessage=a,t.ExternalConnectionClientToApiMessage=class extends s{get port(){return this._port}set port(e){this._port=e}},t.AC_ErrorMessage=class extends a{constructor(e){super("AC_Error"),this.message=e}},t.ExternalConnectionMessageParser=class{constructor(){this.parsers=new Map}registerMessageParser(e,t){this.parsers.set(e,t)}parse(e){const t=e.type;if("string"!=typeof t)throw new Error("Unreadable message type");const s=this.parsers.get(t);if(!s)throw new Error(`Unknown message type ${t}`);return s(e)}}},259:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.HistoryTag=t.MatcherRegex=void 0;class s{constructor(e){this.regex=new RegExp(e)}isMatch(e){return this.regex.test(e)}}t.MatcherRegex=s;class a{constructor(e,t,s,a,r,n){this.matchers=e,this.negative_matchers=t,this.tag=s,this.search_limit_days=a,this.min_matchers_to_qualify=r,this.active=n}static createFromJson(e){return e.map((e=>new a(e.matchers.map((e=>new s(e))),e.negative_matchers.map((e=>new s(e))),e.tag,e.search_limit_days,e.min_matchers_to_qualify,e.active)))}}t.HistoryTag=a},839:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.HistoryTagAssignedEventSource=void 0;class s{constructor(e){this.backend=e,this.tagAssignedCallback=()=>{this.fireEvent()}}static eventNameForTag(e){return`history-tag-assigned-${e}`}fireEvent(){opr.richHintsAgentPrivate.fireEvent({eventName:s.eventNameForTag(this.backend.tagName)})}async activate(e){this.backend.watchForTagAssignment(e)&&this.backend.on("tag-assigned-at-random-time",this.tagAssignedCallback)}async deactivate(e){this.backend.stopWatching(e),this.backend.removeListener("tag-assigned-at-random-time",this.tagAssignedCallback)}}t.HistoryTagAssignedEventSource=s},987:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.HistoryTagEventsBackend=void 0;const a=s(100);class r{}class n{constructor(e,t,s,r,n,i,o){this.tagName=e,this.storageKey=t,this.extensionLaunchType=s,this.extensionLaunchTime=r,this.historyTagUpdater=n,this.historyTagStorage=i,this.state=o,this.eventEmitter=new a.EventEmitter,this.tagsChangedEventListener=()=>{this.reportTagAssigned()},this.watching=!1}static async make(e,t,s,a,i,o){const c=await new Promise((t=>chrome.storage.local.get(e,(s=>{var a;return t(null!==(a=s[e])&&void 0!==a?a:new r)}))));return c.tag_assigned_event_reported=!0===c.tag_assigned_event_reported,new n(a,e,s,t,i,o,c)}static getDefaultStorageKey(e){return`history_tag_assigned_event_source_${e}`}async wasRecentlyLaunchedWithTag(){const e=Date.now();return!("browser_launch"!==this.extensionLaunchType||e-this.extensionLaunchTime>n.LAUNCH_DELAY)&&(await this.historyTagUpdater.waitForPendingUpdate(),this.historyTagStorage.hasTag(this.tagName))}watchForTagAssignment(e){return!this.state.tag_assigned_event_reported&&(this.historyTagStorage.on("tags-changed",this.tagsChangedEventListener),this.watching=!0,!0)}stopWatching(e){this.watching&&(this.historyTagStorage.removeListener("tags-changed",this.tagsChangedEventListener),this.watching=!1)}on(e,t){this.eventEmitter.on(e,t)}removeListener(e,t){this.eventEmitter.removeListener(e,t)}async saveState(){chrome.storage.local.set({[this.storageKey]:this.state})}async setAlreadyReported(){this.state.tag_assigned_event_reported=!0,await this.saveState()}async reportTagAssigned(){!this.state.tag_assigned_event_reported&&this.historyTagStorage.hasTag(this.tagName)&&(await this.setAlreadyReported(),this.eventEmitter.emit("tag-assigned-at-random-time"))}}t.HistoryTagEventsBackend=n,n.LAUNCH_DELAY=2e4},603:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.HistoryTagStorage=void 0;const a=s(100),r=s(259);class n{constructor(e,t){this.tagState=e,this.variableStore=t,this.eventEmitter=new a.EventEmitter}hasTag(e){return!0===this.tagState.get(e)}static tagNameToStorageName(e){return`history_tag_${e}`}stateToStorage(){const e={history_tags:{}};return this.tagState.forEach(((t,s)=>e.history_tags[s]=t)),e}static async readHistoryTagsFromJson(e){const t=await fetch(chrome.runtime.getURL(e)),s=await t.json();return r.HistoryTag.createFromJson(s).filter((e=>e.active))}static registerVariables(e,t){t.forEach((t=>e.registerIntVariable(n.tagNameToStorageName(t.tag),0)))}static async load(e,t){const s=await new Promise((t=>chrome.storage.local.get(e,t))),a=new Map(Object.keys(s).map((e=>[e,!0===s[e]])));return new n(a,t)}on(e,t){this.eventEmitter.on(e,t)}removeListener(e,t){this.eventEmitter.removeListener(e,t)}async save(e){const t=Array.from(e.keys()).some((t=>this.tagState.get(t)!==e.get(t)))||Array.from(this.tagState.keys()).some((t=>this.tagState.get(t)!==e.get(t)));this.tagState=e;const s=this.stateToStorage();await new Promise((e=>chrome.storage.local.set(s,e)));for(const e of Array.from(this.tagState.entries()))await this.variableStore.setInt(n.tagNameToStorageName(e[0]),e[1]?1:0,"dont_flush");await this.variableStore.save(),t&&this.eventEmitter.emit("tags-changed")}}t.HistoryTagStorage=n},854:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.HistoryTagUpdater=void 0;class s{constructor(e,t,s){this.storage=e,this.tags=t,setInterval((()=>this.updateTags()),s)}init(e){e.on("start-providing-events",(()=>{this.updateTags()}))}async updateTags(){this.updatingAfterSpecChangePromise||(this.updatingAfterSpecChangePromise=(async()=>{await this.storage.save(await this.calculateTagsFromHistory())})(),await this.updatingAfterSpecChangePromise,this.updatingAfterSpecChangePromise=void 0)}async waitForPendingUpdate(){return this.updatingAfterSpecChangePromise?this.updatingAfterSpecChangePromise:Promise.resolve()}async searchHistory(e){return new Promise((t=>chrome.history.search({text:"",startTime:e,maxResults:1e5},t)))}anyResultMatches(e,t,s){return e.some((e=>!(!e.lastVisitTime||e.lastVisitTime<s)&&void 0!==t.find((t=>t.isMatch(e.url)))))}nResultsMatch(e,t,s,a){let r=Array.from(new Set(e.flat().map((e=>{if(e.lastVisitTime&&!(e.lastVisitTime<a))return void 0!==t.find((t=>t.isMatch(e.url)))?e.url:void 0})).filter((e=>e)).map((e=>e))));return t.filter((e=>r.some((t=>e.isMatch(t))))).length>=s}async calculateTagsFromHistory(){const e=Math.max(...this.tags.map((e=>e.search_limit_days))),t=await this.searchHistory(e);return new Map(await Promise.all(this.tags.map((async e=>{const a=Date.now()-e.search_limit_days*s.DAYS_TO_MS;return this.anyResultMatches(t,e.negative_matchers,a)?[e.tag,!1]:[e.tag,this.nResultsMatch(t,e.matchers,e.min_matchers_to_qualify,a)]}))))}}t.HistoryTagUpdater=s,s.DAYS_TO_MS=864e5},220:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.InjectionBasedPageApiManager=t.InjectionBasedWeb3InsightsApi=t.InjectionBasedStartpageApi=t.InjectionBasedPageApi=t.Web3InsightsContentScriptMessageRelay=t.StartpageContentScriptMessageRelay=void 0;const a=s(235),r=s(100),n=s(278),i=s(696),o=s(605);class c{constructor(e){this.messageConverter=e,this.awaitingResponse=new Map}acceptContentScriptConnection(e){e.onMessage.addListener((t=>{this.onMessageFromContentScript(e,t)}))}async relayMessageFromApiClient(e,t){await this.postMessageToContentScript(this.messageConverter.convertCAToACS(e)),this.awaitingResponse.set(e.id,t)}handleEventMessage(e,t){return!1}onMessageFromContentScript(e,t){try{const s=this.messageConverter.covertRawCSAToCSA(t);if(this.handleEventMessage(e,s))return;const a=this.awaitingResponse.get(s.requestId);a&&(a.postMessage(this.messageConverter.convertCSAToAC(s)),this.awaitingResponse.delete(s.requestId))}catch(e){return}}}class d extends c{constructor(e){super(e),this.contentScriptPortsForWindows=new Map,this.eventEmitter=new r.EventEmitter}hasContentScriptConnectionForWindow(e){return!!this.contentScriptPortsForWindows.get(e)}static defaultMessageConverter(){return{convertCAToACS:e=>{if("CA_CallStartpageFunction"===e.type){const t=e;switch(t.functionName){case"TestStartpageFunction":return i.CallTestStartpageFunctionMessage.fromParams(t.id,t.windowId,t.params);case"DisplayTargetedSDSection":return i.DisplayTargetedSDSectionFunctionMessage.fromParams(t.id,t.windowId,t.params);default:throw new Error(`Unrecognized function: ${t.functionName}`)}}throw new Error(`Message type ${e.type} does not map to a content script message`)},covertRawCSAToCSA:e=>{if("CSA_CallStartpageFunctionResponse"===e.type)return i.CSA_CallStartpageFunctionResponseMessage.fromRawMessage(e);if("CSA_StartpageAPIEvent"===e.type)return i.CSA_StartpageAPIEventMessage.fromRawMessage(e);throw new Error("Unknown message received")},convertCSAToAC:e=>{if("CSA_CallStartpageFunctionResponse"!==e.type)throw new Error(`Unsupported message type ${e.type}`);const t=e;return new o.AC_CallStartpageFunctionResponseMessage({result:t.result,data:t.data})}}}on(e,t){this.eventEmitter.on(e,t)}onStartpageEvent(e){this.eventEmitter.on("startpage-script-event",e)}acceptContentScriptConnection(e){const t=e.sender.tab.windowId;if(this.contentScriptPortsForWindows.has(t))return e.postMessage(new i.ACS_ErrorMessage("This window already has an active startpage content script connection")),void e.disconnect();this.contentScriptPortsForWindows.set(t,e),this.eventEmitter.emit("startpage-script-ready",t),e.onDisconnect.addListener((()=>{this.contentScriptPortsForWindows.delete(t)})),super.acceptContentScriptConnection(e)}async postMessageToContentScript(e){const t=e,s=this.contentScriptPortsForWindows.get(t.windowId);s?s.postMessage(t):await new Promise(((e,s)=>{chrome.windows.get(t.windowId,(e=>{e||s(new Error(`No window of id ${t.windowId}`)),s(new Error(`SD content script not ready in window id ${t.windowId}`))}))}))}handleEventMessage(e,t){if("CSA_StartpageAPIEvent"===t.type){const s=t;return this.eventEmitter.emit("startpage-script-event",e.sender.tab.windowId,s.name,s.data),!0}return!1}}t.StartpageContentScriptMessageRelay=d;class l extends c{constructor(e){super(e),this.eventEmitter=new r.EventEmitter}static defaultMessageConverter(){return{convertCAToACS:e=>{throw new Error(`Message type ${e.type} does not map to a content script message`)},covertRawCSAToCSA:e=>{if("CSA_Web3InsightsEvent"===e.type)return i.CSA_Web3InsightsEventMessage.fromRawMessage(e);throw new Error("Unknown message received")},convertCSAToAC:e=>{throw new Error(`Unsupported message type ${e.type}`)}}}on(e,t){this.eventEmitter.on(e,t)}onWeb3InsightsEvent(e){this.eventEmitter.on("web3-insights-event",e)}acceptContentScriptConnection(e){super.acceptContentScriptConnection(e)}async postMessageToContentScript(e){}handleEventMessage(e,t){if("CSA_Web3InsightsEvent"===t.type){const e=t;return this.eventEmitter.emit("web3-insights-event",e.name,e.data),!0}return!1}}t.Web3InsightsContentScriptMessageRelay=l;class h{constructor(e,t,s){this.messageRelay=e,this.apiLevel=t,this.apiName=s,this.activeClients=[]}get apiLevelVariableName(){return`${this.apiName}_api_level`}registerVariables(e,t){e.registerIntVariable(this.apiLevelVariableName,this.apiLevel)}publishApiLevel(e){e.setInt(this.apiLevelVariableName,this.apiLevel)}onClientConnected(e){this.activeClients.push(e)}onClientDisconnected(e){this.activeClients.splice(this.activeClients.indexOf(e),1)}onMessageFromApiClient(e,t){"CA_GetApiLevel"!==t.type?this.messageRelay.relayMessageFromApiClient(t,e).then().catch((t=>{e.postMessage(new n.AC_ErrorMessage(t.message))})):e.postMessage(new o.AC_GetApiLevelResponseMessage(this.apiLevel))}acceptContentScriptConnection(e){this.messageRelay.acceptContentScriptConnection(e)}}t.InjectionBasedPageApi=h;class g extends h{constructor(e,t){super(t,g.API_LEVEL,g.API_PORT_NAME),this.externalConnectionMessageParser=e,this.startpageMessageRelay=t,this.externalConnectionMessageParser.registerMessageParser(o.CA_CallStartpageFunctionMessage.MESSAGE_TYPE,o.CA_CallStartpageFunctionMessage.fromRawMessage),this.externalConnectionMessageParser.registerMessageParser(o.CA_GetInjectedScriptStatusMessage.MESSAGE_TYPE,o.CA_GetInjectedScriptStatusMessage.fromRawMessage),(0,a.reloadStartpagesInAllWindowsWhenInBackground)((()=>{})),t.on("startpage-script-ready",(e=>this.onStartpageMessageSinkReady(e))),t.onStartpageEvent(((e,t,s)=>this.onStartpageEvent(e,t,s)))}onMessageFromApiClient(e,t){"CA_GetInjectedScriptStatus"!==t.type?super.onMessageFromApiClient(e,t):e.postMessage(new o.AC_GetInjectedScriptStatusResponseMessage(this.startpageMessageRelay.hasContentScriptConnectionForWindow(t.windowId)))}onStartpageMessageSinkReady(e){this.activeClients.forEach((t=>{t.postMessage(new o.AC_WindowScriptsReadyMessage(e))}))}onStartpageEvent(e,t,s){this.activeClients.forEach((a=>{a.postMessage(new o.AC_StartpageAPIEvent(e,t,s))}))}}t.InjectionBasedStartpageApi=g,g.API_PORT_NAME="sd_cs",g.API_LEVEL=3;class p extends h{constructor(e,t){super(t,p.API_LEVEL,p.API_PORT_NAME),this.externalConnectionMessageParser=e,this.web3InsightsMessageRelay=t,this.externalConnectionMessageParser.registerMessageParser(o.CA_CallStartpageFunctionMessage.MESSAGE_TYPE,o.CA_CallStartpageFunctionMessage.fromRawMessage),this.externalConnectionMessageParser.registerMessageParser(o.CA_GetInjectedScriptStatusMessage.MESSAGE_TYPE,o.CA_GetInjectedScriptStatusMessage.fromRawMessage),(0,a.reloadStartpagesInAllWindowsWhenInBackground)((()=>{})),t.onWeb3InsightsEvent(((e,t)=>this.onWeb3InsightsEvent(e,t)))}onMessageFromApiClient(e,t){super.onMessageFromApiClient(e,t)}onWeb3InsightsEvent(e,t){opr.richHintsAgentPrivate.reportFeedback(opr.richHintsAgentPrivate.FeedbackType.DIAGNOSTICS,`window.ethereum,${t.origin}`)}}t.InjectionBasedWeb3InsightsApi=p,p.API_PORT_NAME="web3insights",p.API_LEVEL=1,t.InjectionBasedPageApiManager=class{constructor(e,t,s){this.pageApis=s,t.registerMessageParser(o.CA_GetApiLevelMessage.MESSAGE_TYPE,(()=>new o.CA_GetApiLevelMessage)),this.registerApisWithBroker(e),chrome.runtime.onConnect.addListener((e=>{const t=this.pageApis.get(e.name);if(!t)return e.postMessage(new i.ACS_ErrorMessage(`Content script claims to serve an API '${e.name}' that does not exist`)),void e.disconnect();t.acceptContentScriptConnection(e)}))}registerApisWithBroker(e){this.pageApis.forEach(((t,s)=>{e.registerConnectionListener(s,(e=>{t.onClientConnected(e),e.onMessage((s=>{t.onMessageFromApiClient(e,s)})),e.onDisconnect((()=>{t.onClientDisconnected(e)}))}))}))}static defaultServicedApiMap(e){const t=new Map;return t.set(g.API_PORT_NAME,new g(e,new d(d.defaultMessageConverter()))),t.set(p.API_PORT_NAME,new p(e,new l(l.defaultMessageConverter()))),t}static registerVariables(e,t){t.forEach(((t,s)=>{t.registerVariables(e,s)}))}}},605:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.AC_GetInjectedScriptStatusResponseMessage=t.AC_GetApiLevelResponseMessage=t.AC_StartpageAPIEvent=t.AC_CallStartpageFunctionResponseMessage=t.AC_WindowScriptsReadyMessage=t.CA_CallStartpageFunctionMessage=t.UseInjectionBasedApiMessage=t.CA_GetInjectedScriptStatusMessage=t.CA_GetApiLevelMessage=t.ClientToApiInjectionBasedApiMessage=void 0;const a=s(541),r=s(278),n=s(278);class i extends r.ExternalConnectionClientToApiMessage{}t.ClientToApiInjectionBasedApiMessage=i;class o extends i{constructor(){super(o.MESSAGE_TYPE)}}t.CA_GetApiLevelMessage=o,o.MESSAGE_TYPE="CA_GetApiLevel";class c extends i{constructor(e){super(c.MESSAGE_TYPE),this.windowId=e}static fromRawMessage(e){const t=e.windowId;if("number"!=typeof t)throw new Error("windowId invalid");return new c(t)}}t.CA_GetInjectedScriptStatusMessage=c,c.MESSAGE_TYPE="CA_GetInjectedScriptStatus";class d extends i{constructor(e,t){super(e),this.functionName=t}}t.UseInjectionBasedApiMessage=d;class l extends d{constructor(e,t,s){super(l.MESSAGE_TYPE,e),this.windowId=t,this.params=s}static fromRawMessage(e){const t=e.functionName;if(t!==a.TEST_STARTPAGE_FUNCTION&&t!==a.DISPLAY_TARGETED_SD_SECTION_FUNCTION)throw new Error(`functionName invalid: ${t}`);const s=e.windowId;if("number"!=typeof s)throw new Error("windowId invalid");const r=e.params;if("object"!=typeof r)throw new Error("params should be an object");const n=new Map;for(const e in r)n.set(e,r[e]);return new l(t,s,n)}}t.CA_CallStartpageFunctionMessage=l,l.MESSAGE_TYPE="CA_CallStartpageFunction";class h extends n.ExternalConnectionApiToClientMessage{constructor(e){super(h.MESSAGE_TYPE),this.windowId=e}}t.AC_WindowScriptsReadyMessage=h,h.MESSAGE_TYPE="AC_WindowScriptsReady";class g extends n.ExternalConnectionApiToClientMessage{constructor(e){super(g.MESSAGE_TYPE),this.data=e}}t.AC_CallStartpageFunctionResponseMessage=g,g.MESSAGE_TYPE="AC_CallStartpageFunctionResponse";class p extends n.ExternalConnectionApiToClientMessage{constructor(e,t,s){super(p.MESSAGE_TYPE),this.windowId=e,this.name=t,this.data=s}}t.AC_StartpageAPIEvent=p,p.MESSAGE_TYPE="AC_StartpageAPIEvent";class u extends n.ExternalConnectionApiToClientMessage{constructor(e){super(u.MESSAGE_TYPE),this.apiLevel=e}}t.AC_GetApiLevelResponseMessage=u,u.MESSAGE_TYPE="AC_GetApiLevelResponse";class v extends n.ExternalConnectionApiToClientMessage{constructor(e){super(v.MESSAGE_TYPE),this.scriptsReady=e}}t.AC_GetInjectedScriptStatusResponseMessage=v,v.MESSAGE_TYPE="AC_GetInjectedScriptStatusResponse"},541:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.DISPLAY_TARGETED_SD_SECTION_FUNCTION=t.TEST_STARTPAGE_FUNCTION=void 0,t.TEST_STARTPAGE_FUNCTION="TestStartpageFunction",t.DISPLAY_TARGETED_SD_SECTION_FUNCTION="DisplayTargetedSDSection"},952:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ManyTabsEventSource=void 0;class s{constructor(e,t=s.DEFAULT_MIN_NUMBER_OF_TABS,a=s.DEFAULT_EVENT_FIRE_DELAY){this.performanceVariableCollector=e,this.minNumberOfTabs=t,this.timeToFireEvent=a}areManyTabsOpen(){return this.performanceVariableCollector.totalTabNumber>=this.minNumberOfTabs}async fireEventCallback(){this.areManyTabsOpen()&&opr.richHintsAgentPrivate.fireEvent({eventName:s.NAME}),delete this.timeoutId}async onTotalTabNumberChangedListener(){this.areManyTabsOpen()?void 0===this.timeoutId&&(this.timeoutId=setTimeout(this.fireEventCallback.bind(this),this.timeToFireEvent)):void 0!==this.timeoutId&&(clearTimeout(this.timeoutId),delete this.timeoutId)}async activate(){this.listenerObject=()=>this.onTotalTabNumberChangedListener(),this.performanceVariableCollector.addTotalTabNumberChangedListener(this.listenerObject)}async deactivate(){this.performanceVariableCollector.removeTotalTabNumberChangedListener(this.listenerObject),delete this.listenerObject,clearTimeout(this.timeoutId),delete this.timeoutId}}t.ManyTabsEventSource=s,s.NAME="many-tabs-grow-2382",s.DEFAULT_MIN_NUMBER_OF_TABS=25,s.DEFAULT_EVENT_FIRE_DELAY=6e5},365:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.PerformanceVariableCollector=void 0;const a=s(100);class r{constructor(e,t,s){this.constants=e,this.variableStore=t,this.clock=s,this.eventEmitter=new a.EventEmitter}static isBoosterApiAvailable(e){return"gx"===e.productType}static isLimitersApiAvailable(e){return"gx"===e.productType}static registerVariables(e,t){t.registerStringVariable("downloads_size",this.VARIABLES.downloads_size.default),t.registerStringVariable("total_tab_count",this.VARIABLES.total_tab_count.default),r.isBoosterApiAvailable(e)&&t.registerStringVariable("browser_files_size",this.VARIABLES.browser_files_size.default),r.isLimitersApiAvailable(e)&&t.registerStringVariable("ram_usage",this.VARIABLES.ram_usage.default)}async init(){chrome.tabs.onCreated.addListener((()=>this.collectTabStats())),chrome.tabs.onRemoved.addListener((()=>this.collectTabStats())),chrome.downloads.onChanged.addListener((()=>this.collectDownloadsStats())),chrome.downloads.onErased.addListener((()=>this.collectDownloadsStats())),chrome.downloads.onCreated.addListener((()=>this.collectDownloadsStats())),this.clock.setOnBeforeMinutePassedBarrier((()=>this.collectPerformanceStats())),await this.collectTabStats(),await this.collectDownloadsStats(),await this.collectPerformanceStats()}get totalTabNumber(){return this.totalTabNumber_}addTotalTabNumberChangedListener(e){this.eventEmitter.on("total-tab-number-changed",e)}removeTotalTabNumberChangedListener(e){this.eventEmitter.removeListener("total-tab-number-changed",e)}async collectTabStats(){const e=await new Promise((e=>chrome.windows.getAll({populate:!0},e)));this.totalTabNumber_=e.filter((e=>"normal"===e.type)).map((e=>e.tabs.length)).reduce(((e,t)=>t+e),0),this.variableStore.setInt("total_tab_count",this.totalTabNumber_),this.eventEmitter.emit("total-tab-number-changed",this.totalTabNumber_)}async getDownloadsDiskSpace(){return new Promise((e=>{chrome.downloads.search({exists:!0},(t=>{e(t.reduce(((e,t)=>e+(t.exists?t.bytesReceived:0)),0))}))}))}async collectDownloadsStats(){var e;this.variableStore.setInt("downloads_size",(e=await this.getDownloadsDiskSpace(),Math.floor(e/1048576)))}async collectPerformanceStats(){if(r.isBoosterApiAvailable(this.constants)){const e=await new Promise((e=>chrome.boosterPrivate.getTotalUsedDiskSpace(e)));this.variableStore.setInt("browser_files_size",e)}if(r.isLimitersApiAvailable(this.constants)){const e=await new Promise((e=>opr.limitersPrivate.getCurrentMemoryUsage(e)));this.variableStore.setInt("ram_usage",e.memoryUsed)}}}t.PerformanceVariableCollector=r,r.VARIABLES={total_tab_count:{default:0,description:"Total tabs in all windows"},ram_usage:{default:0,description:"RAM usage (polled every minute)"},browser_files_size:{default:0,description:"Browser file size (polled every minute)"},downloads_size:{default:0,description:"Downloads size (polled every minute)"}}},312:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.TabChangedEventSource=void 0;class s{constructor(e,t,s,a){this.fireEvent=e,this.onTabActivated=t,this.tabsGetFunction=s,this.variableStore=a}static registerVariables(e){for(const t in this.VARIABLES)e.registerStringVariable(t,this.VARIABLES[t].default)}async listener(e){const t=await new Promise((t=>this.tabsGetFunction(e.tabId,t)));await this.variableStore.setString("last_navigation",t.url),this.fireEvent({eventName:s.NAME,windowId:e.windowId})}async activate(){this.listenerObject=this.listener.bind(this),this.onTabActivated.addListener(this.listenerObject)}async deactivate(){this.onTabActivated.removeListener(this.listenerObject),this.listenerObject=null}}t.TabChangedEventSource=s,s.VARIABLES={last_navigation:{default:"none",description:"Last navigated url"}},s.NAME="tab-changed"},86:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.TemporaryPatches=void 0;class s{constructor(){opr.browserSidebarPrivate&&opr.browserSidebarPrivate.onItemExpanded&&opr.browserSidebarPrivate.onItemExpanded.addListener(this.onItemExpanded)}onItemExpanded(e){e===s.LASTCARD_ID&&chrome.runtime.sendMessage(s.LASTCARD_ID,{type:"ToggleRedDot",data:!1})}}s.LASTCARD_ID="niedpkpgcoojodjamdaecieijchonfnm",t.TemporaryPatches=class{constructor(){this.lastpass=new s}}},379:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.VariableRegistry=void 0,t.VariableRegistry=class{constructor(){this._variables=new Map}get variables(){return this._variables}registerIntVariable(e,t){this.variables.set(e,t)}registerStringVariable(e,t){this.variables.set(e,t)}}},768:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.VariableStore=void 0;class s{constructor(e,t){this.storage=e,this.settings=t}static async saveInternal(e,t){await new Promise((s=>e.set(t,s)))}async setInt(e,t,s){if(!(e in this.settings.trigger_variables.int))throw new Error("Attempted to set an unregistered int variable: "+e);this.settings.trigger_variables.int[e]=t,void 0!==s&&"flush"!==s||await this.save()}async setString(e,t,s){if(!(e in this.settings.trigger_variables.string))throw new Error("Attempted to set an unregistered int variable: "+e);this.settings.trigger_variables.string[e]=t,void 0!==s&&"flush"!==s||await this.save()}getInt(e){const t=this.settings.trigger_variables.int[e];if(void 0===t)throw new Error("Variable not registered");return t}getString(e){const t=this.settings.trigger_variables.string[e];if(void 0===t)throw new Error("Variable not registered");return t}async save(){await s.saveInternal(this.storage,this.settings)}static async load(e,t){var a;const r={trigger_variables:null!==(a=(await new Promise((t=>e.get((e=>t(e)))))).trigger_variables)&&void 0!==a?a:{int:{},string:{}}};return["int","string"].forEach((e=>{const s=new Set;for(const a in r.trigger_variables[e])(()=>{const s=t.variables.get(a);return(void 0===s?"none":"string"==typeof s?"string":"int")!==e})()&&s.add(a);s.forEach((t=>{delete r.trigger_variables[e][t]}))})),t.variables.forEach(((e,t)=>{const s="string"==typeof e?"string":"int",a="string"==typeof e?"int":"string";t in r.trigger_variables[s]||(r.trigger_variables[s][t]=e),t in r.trigger_variables[a]&&delete r.trigger_variables[a][t]})),await s.saveInternal(e,r),new s(e,r)}}t.VariableStore=s}},t={};function s(a){var r=t[a];if(void 0!==r)return r.exports;var n=t[a]={exports:{}};return e[a](n,n.exports,s),n.exports}(()=>{const e=s(778),t=s(175),a=s(888),r=s(71),n=s(312),i=s(952),o=s(379),c=s(768),d=s(854),l=s(603),h=s(932),g=s(839),p=s(987),u=s(793),v=s(977),m=s(220),w=s(919),b=s(727),A=s(278),E=s(86),f=s(498),S=s(365),_=s(254),C=s(150);document.errorReporter=new r.ErrorReporter,document.addEventListener("DOMContentLoaded",(async()=>{const s=new C.Constants(await C.Constants.getProductType()),r=new A.ExternalConnectionMessageParser,y=m.InjectionBasedPageApiManager.defaultServicedApiMap(r),M=new o.VariableRegistry;n.TabChangedEventSource.registerVariables(M),u.CashbackBadgeShownEventSource.registerVariables(M),m.InjectionBasedPageApiManager.registerVariables(M,y),w.ExtensionPromotions.registerVariables(M),a.Adblock.registerVariables(M);const T=await l.HistoryTagStorage.readHistoryTagsFromJson("history-tags.json");l.HistoryTagStorage.registerVariables(M,T),f.AgentClock.registerVariables(M),S.PerformanceVariableCollector.registerVariables(s,M),_.CheckoutPageEventSource.isAvailable()&&_.CheckoutPageEventSource.registerVariables(M);const I=await c.VariableStore.load(chrome.storage.local,M);y.forEach((e=>e.publishApiLevel(I)));const P=new b.ExternalConnectionBroker(r,b.defaultExternalConnectionPortFactory);document.injectionBasedPageApiManager=new m.InjectionBasedPageApiManager(P,r,y),document.extensionPromotions=new w.ExtensionPromotions(I),document.adblock=new a.Adblock(I);const L=await(0,v.checkExtensionLaunchType)(),N=new f.AgentClock(I);await N.init(L),document.performanceVariableCollector=new S.PerformanceVariableCollector(s,I,N),document.performanceVariableCollector.init();const R=new Map;R.set(n.TabChangedEventSource.NAME,(()=>new n.TabChangedEventSource(opr.richHintsAgentPrivate.fireEvent,chrome.tabs.onActivated,chrome.tabs.get,I))),R.set(i.ManyTabsEventSource.NAME,(()=>new i.ManyTabsEventSource(document.performanceVariableCollector))),u.CashbackBadgeShownEventSource.isAvailable()&&R.set(u.CashbackBadgeShownEventSource.NAME,(()=>new u.CashbackBadgeShownEventSource(I))),_.CheckoutPageEventSource.isAvailable()&&R.set(_.CheckoutPageEventSource.NAME,(()=>new _.CheckoutPageEventSource(I))),R.set(f.ClockEventSource.NAME,(()=>new f.ClockEventSource(N)));const k=await l.HistoryTagStorage.load("history_tags",I),F=new d.HistoryTagUpdater(k,T,18e5),O=Date.now();for(const e of T){const t=await p.HistoryTagEventsBackend.make(p.HistoryTagEventsBackend.getDefaultStorageKey(e.tag),O,L,e.tag,F,k);R.set(h.BrowserLaunchedWithTagAssigned.eventNameForTag(e.tag),(()=>new h.BrowserLaunchedWithTagAssigned(t))),R.set(g.HistoryTagAssignedEventSource.eventNameForTag(e.tag),(()=>new g.HistoryTagAssignedEventSource(t)))}const x=new t.EventSourceFactoryImpl(R);document.eventRegistry=new e.EventRegistry(opr.richHintsAgentPrivate.onSpecificationUpdated,opr.richHintsAgentPrivate.provideEvents,x),document.patches=new E.TemporaryPatches,F.init(document.eventRegistry),document.eventRegistry.registerEvents()}),!1)})()})();